{% extends '_layout_base.html' %}

{% block head_title %}{{ request_location or '<home>' }}{% endblock %}

{% block css %}
    <link href="{{ static_path('app.browser.css') }}" rel="stylesheet">
{% endblock %}

{% block js %}
    <script>
        currentLocation = '{{ request_location }}';
        rpcSocketUrl    = 'ws://' + location.hostname + ':' + location.port + '{{ app.path("socket.rpc") }}';
    </script>
    <script src="{{ static_path('app.browser.js') }}"></script>
{% endblock %}

{% block content %}
{% include '_menu.html' %}
<article class="explorer-chrome">
    <header>
        {% if request_location %}<a href="{{ app.path('ui.tree', path = parent_path) }}">Back to <b>{{ parent_path or '<home>' | escape }}</b></a>{% endif %}
        <h1><span class="fa fa-dot-circle-o"></span> {{ request_location or '<home>' | escape }}</h1>
    </header>
    <ul class="node-list">
        {%- for fs_node in fs_nodes -%}
            {%- set mtype = fs_node.mimetype or 'unknown' -%}
            {%- set url   = app.path('ui.tree' if fs_node.is_dir else 'ui.file.editor', path = fs_node.referred_path) -%}
            {%- set icon  = 'cubes' if fs_node.is_dir else 'cube' -%}
            {%- if fs_node.is_binary -%}
                {%- set url  = app.path('api.file', path = fs_node.path) -%}
                {%- set icon = 'cloud-download' -%}
            {%- endif -%}
            <li class="node"
                data-name="{{ fs_node.name }}"
                data-type="{{ mtype }}"
                data-path="{{ fs_node.path }}">
                <a href="{{ url }}"
                   title="{{ fs_node.name }}{% if fs_node.is_file %} ({{ mtype }}){% endif %}">
                    <span class="node-marker fa fa-circle-o" title="Pick me!"></span>
                    <span class="node-icon fa fa-fw fa-{{ icon }}"></span>
                    <span class="node-name">{{ fs_node.name }}</span>
                </a>
            </li>
        {%- endfor -%}
        <script id="entry-template" type="text/x-handlebars-template">{%- raw -%}
            <li class="node"
                data-name="{{ name }}"
                data-type="{{ mtype }}"
                data-path="{{ path }}">
                <a href="{{ url }}"
                   title="{{ title }}">
                    <span class="node-marker fa fa-circle-o" title="Pick me!"></span>
                    <span class="node-icon fa fa-fw fa-{{ icon }}"></span>
                    <span class="node-name">{{ name }}</span>
                </a>
            </li>
        {%- endraw -%}</script>
    </ul>
</article>
<script>
    request_location = '{{ request_location }}';
</script>
{% endblock %}
